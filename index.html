<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">

    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js"></script>
    
    <style>
        :root {
            --primary-color: #2a6fdb;
            --secondary-color: #6c757d;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --info-color: #17a2b8;
            --light-color: #f8f9fa;
            --dark-color: #343a40;
            --border-color: #dee2e6;
        }

        body {
            font-family: 'Cairo', sans-serif;
            margin: 0;
            background-color: var(--light-color);
            color: var(--dark-color);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            margin-bottom: 20px;
        }

        .header-top {
             display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
            padding-bottom: 15px;
            margin-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
        }
        
        h1 { margin: 0; font-size: 1.8em; color: var(--primary-color); }

        .search-container {
            flex-grow: 1;
            display: flex;
            justify-content: center;
        }
        #searchInput {
            width: 100%;
            max-width: 500px;
            padding: 12px 15px;
            border: 1px solid var(--border-color);
            border-radius: 25px;
            font-family: 'Cairo', sans-serif;
            font-size: 1em;
        }

        nav {
            display: flex;
            gap: 10px;
        }
        .nav-btn {
            flex-grow: 1;
            background-color: var(--secondary-color);
            opacity: 0.7;
        }
        .nav-btn.active {
            background-color: var(--primary-color);
            opacity: 1;
            font-weight: bold;
        }
        
        .btn {
            padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer;
            font-size: 1em; font-family: 'Cairo', sans-serif; color: #fff;
            transition: background-color 0.3s; margin: 0 5px;
        }

        .btn-primary { background-color: var(--primary-color); }
        .btn-secondary { background-color: var(--secondary-color); }
        
        .view { display: none; }
        .view.active { display: block; }

        .table-container { 
            overflow-x: auto; background-color: #fff;
            padding: 20px; border-radius: 8px;
        }
        table { width: 100%; border-collapse: collapse; }
        th, td { text-align: right; padding: 15px; border-bottom: 1px solid var(--border-color); }
        th { font-weight: 700; }
        td .btn { padding: 8px 12px; font-size: 0.9em;}
        
        .status {
            padding: 5px 10px; border-radius: 20px; color: #fff;
            font-weight: 600; font-size: 0.9em; text-align: center;
            display: inline-block; min-width: 70px;
        }
        .status-for-sale { background-color: var(--success-color); }
        .status-sold { background-color: var(--danger-color); }

        .modal {
            display: none; position: fixed; z-index: 1000; left: 0; top: 0;
            width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.6);
            justify-content: center; align-items: center;
        }
        .modal.active { display: flex; }
        .modal-content {
            background-color: #fff; padding: 30px; border-radius: 8px;
            width: 90%; max-width: 800px;
        }
        .modal-header { display: flex; justify-content: space-between; align-items: center; padding-bottom: 15px; margin-bottom: 25px; border-bottom: 1px solid var(--border-color); }
        .modal-header h2 { margin: 0; }
        .close-btn { font-size: 2em; cursor: pointer; line-height: 1; }
        
        .form-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        .form-group { margin-bottom: 10px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 600; }
        .form-group input, .form-group textarea {
            width: 100%; padding: 10px; border: 1px solid var(--border-color);
            border-radius: 4px; box-sizing: border-box; font-family: 'Cairo', sans-serif;
        }
        
        #barcode-container { text-align: center; padding: 20px; }
        #barcode-product-info { margin-top: 15px; font-weight: bold; font-size: 1.2em; }
        
        @media print {
            body * { visibility: hidden; }
            #barcode-modal, #barcode-modal * { visibility: visible; }
            #barcode-modal { position: absolute; left: 0; top: 0; }
            .modal-content { margin: auto; border: none; box-shadow: none; }
            .modal-header, .modal-footer { display: none; }
        }
    </style>
</head>
<body>

    <div class="container">
        <header>
            <div class="header-top">
                <h1>ğŸ“± Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©</h1>
                <div class="search-container">
                    <input type="search" id="searchInput" placeholder="Ø§Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ...">
                </div>
                <button id="addDeviceBtn" class="btn btn-primary">Ø¥Ø¶Ø§ÙØ© Ø¬Ù‡Ø§Ø²</button>
            </div>
            <nav>
                <button class="nav-btn active" data-view="inventory-view">Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ø­Ø§Ù„ÙŠ</button>
                <button class="nav-btn" data-view="sold-view">Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ù…Ø¨Ø§Ø¹Ø©</button>
            </nav>
        </header>

        <main>
            <div id="inventory-view" class="view active">
                <div class="table-container">
                    <table>
                        <thead><tr><th>Ù†ÙˆØ¹ Ø§Ù„Ø¬Ù‡Ø§Ø²</th><th>Ø§Ù„Ù„ÙˆÙ†</th><th>Ø§Ù„Ù…Ø³Ø§Ø­Ø©</th><th>Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th></tr></thead>
                        <tbody id="inventory-table-body"></tbody>
                    </table>
                </div>
            </div>
            <div id="sold-view" class="view">
                <div class="table-container">
                     <table>
                        <thead><tr><th>Ù†ÙˆØ¹ Ø§Ù„Ø¬Ù‡Ø§Ø²</th><th>Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡</th><th>Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹</th><th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨ÙŠØ¹</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th></tr></thead>
                        <tbody id="sold-table-body"></tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>
    
    <div id="device-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-title">Ø¥Ø¶Ø§ÙØ© Ø¬Ù‡Ø§Ø² Ø¬Ø¯ÙŠØ¯</h2>
                <span class="close-btn">&times;</span>
            </div>
            <form id="device-form">
                <input type="hidden" id="device-id">
                <h3 style="color: var(--primary-color);">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø±Ø§Ø¡ ÙˆØ§Ù„Ø¬Ù‡Ø§Ø²</h3>
                <div class="form-grid">
                    <div class="form-group"><label for="device-type">Ù†ÙˆØ¹ Ø§Ù„Ø¬Ù‡Ø§Ø²</label><input type="text" id="device-type" required></div>
                    <div class="form-group"><label for="device-color">Ù„ÙˆÙ† Ø§Ù„Ø¬Ù‡Ø§Ø²</label><input type="text" id="device-color"></div>
                    <div class="form-group"><label for="device-storage">Ø§Ù„Ù…Ø³Ø§Ø­Ø© (GB)</label><input type="number" id="device-storage"></div>
                    <div class="form-group"><label for="device-battery">Ø­Ø§Ù„Ø© Ø§Ù„Ø¨Ø·Ø§Ø±ÙŠØ© (%)</label><input type="number" id="device-battery" min="0" max="100"></div>
                    <div class="form-group"><label for="purchase-date">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø´Ø±Ø§Ø¡</label><input type="date" id="purchase-date" required></div>
                    <div class="form-group"><label for="purchase-price">Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡</label><input type="number" id="purchase-price" step="0.01" required></div>
                </div>
                <hr style="margin: 30px 0;">
                <h3 style="color: var(--success-color);">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¨ÙŠØ¹ (Ø§Ù…Ù„Ø£Ù‡Ø§ Ø¹Ù†Ø¯ Ø§Ù„Ø¨ÙŠØ¹)</h3>
                <div class="form-grid">
                     <div class="form-group"><label for="sale-date">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨ÙŠØ¹</label><input type="date" id="sale-date"></div>
                    <div class="form-group"><label for="sale-price">Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹ Ø§Ù„ÙØ¹Ù„ÙŠ</label><input type="number" id="sale-price" step="0.01"></div>
                    <div class="form-group"><label for="buyer-name">Ø§Ø³Ù… Ø§Ù„Ù…Ø´ØªØ±ÙŠ</label><input type="text" id="buyer-name"></div>
                </div>
                <div style="text-align: left; margin-top: 30px;">
                    <button type="submit" class="btn btn-primary">Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
                </div>
            </form>
        </div>
    </div>
    <div id="barcode-modal" class="modal">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h2>Ø·Ø¨Ø§Ø¹Ø© Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø§Ù„Ø¬Ù‡Ø§Ø²</h2>
                <span class="close-btn">&times;</span>
            </div>
            <div id="barcode-container">
                <canvas id="barcode-canvas"></canvas>
                <div id="barcode-product-info"></div>
            </div>
            <div class="modal-footer" style="text-align: left; margin-top: 20px;">
                 <button id="printBtn" class="btn btn-info">Ø§Ø·Ø¨Ø¹</button>
            </div>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const addDeviceBtn = document.getElementById('addDeviceBtn');
            const searchInput = document.getElementById('searchInput');
            const navButtons = document.querySelectorAll('.nav-btn');
            const views = document.querySelectorAll('.view');
            const inventoryTableBody = document.getElementById('inventory-table-body');
            const soldTableBody = document.getElementById('sold-table-body');
            const deviceModal = document.getElementById('device-modal');
            const barcodeModal = document.getElementById('barcode-modal');
            const deviceForm = document.getElementById('device-form');
            const modalTitle = document.getElementById('modal-title');
            const printBtn = document.getElementById('printBtn');

            let devices = JSON.parse(localStorage.getItem('my_devices_db_v4')) || [];

            const saveDevices = () => {
                localStorage.setItem('my_devices_db_v4', JSON.stringify(devices));
            };
            
            const renderAllViews = () => {
                renderInventoryTable();
                renderSoldTable();
            };

            const renderInventoryTable = () => {
                const searchTerm = searchInput.value.toLowerCase().trim();
                const forSaleDevices = devices.filter(d => 
                    d.status === 'Ù„Ù„Ø¨ÙŠØ¹' &&
                    (searchTerm === '' || 
                    d.type.toLowerCase().includes(searchTerm) || 
                    (d.color && d.color.toLowerCase().includes(searchTerm)) || 
                    d.id.includes(searchTerm))
                );

                inventoryTableBody.innerHTML = '';
                if (forSaleDevices.length === 0) {
                    inventoryTableBody.innerHTML = `<tr><td colspan="6" style="text-align:center;">${searchTerm ? 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ ØªØ·Ø§Ø¨Ù‚ Ø¨Ø­Ø«Ùƒ.' : 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø¬Ù‡Ø²Ø© Ù…ØªØ§Ø­Ø© Ù„Ù„Ø¨ÙŠØ¹.'}</td></tr>`;
                    return;
                }

                forSaleDevices.forEach(device => {
                    const row = `
                        <tr>
                            <td>${device.type}</td>
                            <td>${device.color || '-'}</td>
                            <td>${device.storage ? device.storage + ' GB' : '-'}</td>
                            <td>${parseFloat(device.purchasePrice).toLocaleString()}</td>
                            <td><span class="status status-for-sale">${device.status}</span></td>
                            <td>
                                <button class="btn btn-primary edit-btn" data-id="${device.id}">ØªØ¹Ø¯ÙŠÙ„/Ø¨ÙŠØ¹</button>
                                <button class="btn btn-secondary barcode-btn" data-id="${device.id}">Ø·Ø¨Ø§Ø¹Ø© Ø¨Ø§Ø±ÙƒÙˆØ¯</button>
                            </td>
                        </tr>
                    `;
                    inventoryTableBody.innerHTML += row;
                });
            };

            const renderSoldTable = () => {
                const searchTerm = searchInput.value.toLowerCase().trim();
                const soldDevices = devices.filter(d => 
                    d.status === 'Ù…Ø¨Ø§Ø¹' &&
                    (searchTerm === '' || 
                    d.type.toLowerCase().includes(searchTerm) || 
                    (d.buyerName && d.buyerName.toLowerCase().includes(searchTerm)) || 
                    d.id.includes(searchTerm))
                );

                soldTableBody.innerHTML = '';
                if (soldDevices.length === 0) {
                    soldTableBody.innerHTML = `<tr><td colspan="6" style="text-align:center;">${searchTerm ? 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ ØªØ·Ø§Ø¨Ù‚ Ø¨Ø­Ø«Ùƒ.' : 'Ù„Ù… ÙŠØªÙ… Ø¨ÙŠØ¹ Ø£ÙŠ Ø£Ø¬Ù‡Ø²Ø© Ø¨Ø¹Ø¯.'}</td></tr>`;
                    return;
                }
                
                soldDevices.forEach(device => {
                    const row = `
                        <tr>
                            <td>${device.type}</td>
                            <td>${parseFloat(device.purchasePrice).toLocaleString()}</td>
                            <td>${parseFloat(device.salePrice).toLocaleString()}</td>
                            <td>${device.saleDate}</td>
                            <td><span class="status status-sold">${device.status}</span></td>
                            <td>
                                <button class="btn btn-primary edit-btn" data-id="${device.id}">Ø¹Ø±Ø¶/ØªØ¹Ø¯ÙŠÙ„</button>
                                <button class="btn btn-secondary barcode-btn" data-id="${device.id}">Ø·Ø¨Ø§Ø¹Ø© Ø¨Ø§Ø±ÙƒÙˆØ¯</button>
                            </td>
                        </tr>
                    `;
                    soldTableBody.innerHTML += row;
                });
            };
            
            const showView = (viewId) => {
                views.forEach(view => view.classList.remove('active'));
                document.getElementById(viewId)?.classList.add('active');
                
                navButtons.forEach(btn => {
                    btn.classList.toggle('active', btn.dataset.view === viewId);
                });
                renderAllViews();
            };

            const openModal = (modalId, device = null) => {
                const modal = document.getElementById(modalId);
                if (!modal) return;

                if (modalId === 'device-modal') {
                    deviceForm.reset();
                    if (device) {
                        modalTitle.textContent = 'ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ù‡Ø§Ø²';
                        document.getElementById('device-id').value = device.id;
                        document.getElementById('device-type').value = device.type;
                        document.getElementById('device-color').value = device.color;
                        document.getElementById('device-storage').value = device.storage;
                        document.getElementById('device-battery').value = device.battery;
                        document.getElementById('purchase-date').value = device.purchaseDate;
                        document.getElementById('purchase-price').value = device.purchasePrice;
                        document.getElementById('sale-date').value = device.saleDate || '';
                        document.getElementById('sale-price').value = device.salePrice || '';
                        document.getElementById('buyer-name').value = device.buyerName || '';
                    } else {
                        modalTitle.textContent = 'Ø¥Ø¶Ø§ÙØ© Ø¬Ù‡Ø§Ø² Ø¬Ø¯ÙŠØ¯';
                        document.getElementById('device-id').value = '';
                    }
                } else if (modalId === 'barcode-modal' && device) {
                    const canvas = document.getElementById('barcode-canvas');
                    const productInfo = document.getElementById('barcode-product-info');
                    QRCode.toCanvas(canvas, device.id, { width: 256 }, (error) => {
                        if (error) console.error(error);
                        productInfo.textContent = `${device.type} - ${device.color || ''}`;
                    });
                }
                modal.classList.add('active');
            };

            const closeModal = () => {
                document.querySelectorAll('.modal').forEach(modal => modal.classList.remove('active'));
            };

            deviceForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const deviceId = document.getElementById('device-id').value;
                const saleDate = document.getElementById('sale-date').value;
                const salePrice = document.getElementById('sale-price').value;
                const status = (saleDate && salePrice) ? 'Ù…Ø¨Ø§Ø¹' : 'Ù„Ù„Ø¨ÙŠØ¹';

                const deviceData = {
                    id: deviceId ? deviceId : Date.now().toString(),
                    type: document.getElementById('device-type').value,
                    color: document.getElementById('device-color').value,
                    storage: document.getElementById('device-storage').value,
                    battery: document.getElementById('device-battery').value,
                    purchaseDate: document.getElementById('purchase-date').value,
                    purchasePrice: document.getElementById('purchase-price').value,
                    saleDate: saleDate,
                    salePrice: salePrice,
                    buyerName: document.getElementById('buyer-name').value,
                    status: status
                };
                
                if (deviceId) {
                    const index = devices.findIndex(d => d.id === deviceId);
                    devices[index] = deviceData;
                } else {
                    devices.push(deviceData);
                }

                saveDevices();
                renderAllViews();
                closeModal();
            });
            
            addDeviceBtn.addEventListener('click', () => openModal('device-modal'));
            
            document.querySelector('main').addEventListener('click', (e) => {
                const target = e.target.closest('.btn');
                if (!target) return;
                const deviceId = target.dataset.id;
                if (!deviceId) return;
                const device = devices.find(d => d.id === deviceId);
                if (target.classList.contains('edit-btn')) {
                    openModal('device-modal', device);
                } else if (target.classList.contains('barcode-btn')) {
                    openModal('barcode-modal', device);
                }
            });

            document.querySelectorAll('.modal').forEach(modal => {
                const closeBtn = modal.querySelector('.close-btn');
                if(closeBtn) {
                   closeBtn.addEventListener('click', closeModal);
                }
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) closeModal();
                });
            });
            
            printBtn.addEventListener('click', () => window.print());

            showView('inventory-view');
        });
    </script>
</body>
</html>
